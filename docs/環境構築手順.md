# 環境構築手順

## 1. 前提ソフトウェア

- Git
- Docker (Docker Desktop もしくは Docker Engine)
- 任意のターミナル (PowerShell / bash など)

## 2. 前提ソフトウェアバージョン確認

PowerShell 例:

```powershell
git --version
docker version
docker compose version
```

エラーにならなければ OK。`docker version` で Server 側情報が表示されない場合は Docker Desktop が起動しているか確認してください。

## 3. リポジトリ取得

```powershell
git clone <REPO_URL>
```

## 4. 初回起動

```powershell
docker compose up -d --build
```

ポイント:

- 初回はコンテナ内で: PostgreSQL 初期化 → 依存 npm install → Prisma migrate  → Next.js dev → Caddy 起動
- 数分かかる場合があります (依存パッケージインストール + DB 初期化)。

ログを追いたい場合:

```powershell
docker compose logs -f --tail=200
```

## 5. 動作確認

- ブラウザで: http://localhost:3000
- ブラウザで: https://localhost

DB へ直接接続 (例: psql / GUI ツール):

docker-compose.yml で定義されている接続情報:

- ホスト (services.db / ports): localhost
- ポート (ports で 5432:5432): 5432
- DB 名 (環境変数 POSTGRES_DB): appdb
- ユーザ (環境変数 POSTGRES_USER): appuser
- パスワード (環境変数 POSTGRES_PASSWORD): appsecret

## 6. 停止

```powershell
docker compose down
```

## 7. クリーン再構築 (データも消したい場合)

注意: DB 内容が消えます。

```powershell
docker compose down -v
docker compose build --no-cache
docker compose up -d
```

または一括 (ビルド込み):

```powershell
docker compose down -v; docker compose up -d --build
```
